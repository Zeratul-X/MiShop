"use strict";var cookieArr=$.cookie(),unameFromCookie=cookieArr.uname,url=location.search,urlArr=url.split("?"),unameStr=urlArr[1].split("="),unameFromUrl=unameStr[1],selectSum=0,allprice=0,ischeckedAll=!1,ischeckedSingle=!1,deleteallArr=Array(),isedit=!1;function actionsInTable(e){$("a.check-label.check-all").on("click",function(){ischeckedAll?($("a.check-label").removeClass("checked"),ischeckedAll=!1,selectSum=0,$("span.sum-selected").html(selectSum),allprice=0):($("a.check-label").addClass("checked"),ischeckedAll=!0,selectSum=e.length,$("span.sum-selected").html(selectSum),getAllPriceWhenCheckAll(e)),$("span.bill-price").html("￥"+allprice.toFixed(2))}),$("td.edit-area>span.edit").on("click",function(){isedit=isedit?($("td.edit-area>span.edit").text("编辑"),$("td.goods-col-ctrl>span").show().siblings().fadeOut(100),!1):($("td.edit-area>span.edit").text("完成"),$("td.goods-col-ctrl>span").show().siblings().fadeIn(100),!0)});for(var a=0;a<e.length;a++){var t=parseInt(e[a][0]);deleteallArr.push(e[a][0]),$("#plus"+e[a][0]).on("click",{currentid:t},function(e){$("#input"+e.data.currentid).val(parseInt($("#input"+e.data.currentid).val())+1);var a=parseInt($("#input"+e.data.currentid).val()),t=a*parseFloat($("#oneprice"+e.data.currentid).html());allprice=t,$("#sumprice"+e.data.currentid).html(t.toFixed(2)+"元"),updateDataToDataBase(a,t,e.data.currentid)}),$("#minus"+e[a][0]).on("click",{currentid:t},function(e){$("#input"+e.data.currentid).val(parseInt($("#input"+e.data.currentid).val())-1);var a=parseInt($("#input"+e.data.currentid).val()),t=parseFloat($("#oneprice"+e.data.currentid).html()),l=a*t;(allprice=l,$("#sumprice"+e.data.currentid).html(l.toFixed(2)+"元"),updateDataToDataBase(a,l,e.data.currentid),parseInt($("#input"+e.data.currentid).val())<1)&&(confirm("是否删除该商品？")?deleteData(e.data.currentid):($("#input"+e.data.currentid).val(parseInt($("#input"+e.data.currentid).val())+1),$("#sumprice"+e.data.currentid).html(t.toFixed(2)+"元"),updateDataToDataBase(1,t,e.data.currentid)))}),$("a#checksingle"+e[a][0]+".check-label.check-product").on("click",{currentid:t,index:a},function(e){allprice=ischeckedAll?($("a#checksingle"+e.data.currentid+".check-label").removeClass("checked"),ischeckedAll=!1,selectSum--,0):($("a#checksingle"+e.data.currentid+".check-label").addClass("checked"),ischeckedAll=!0,selectSum++,parseFloat($("#sumprice"+e.data.currentid).html())),$("span.sum-selected").html(selectSum),$("span.bill-price").html("￥"+allprice.toFixed(2))}),$("span.sum").html(e.length),$("span.sum-selected").html(selectSum),$("span.bill-price").html("￥"+allprice.toFixed(2)),$("i#delgoods"+e[a][0]+".del-product").on("click",{currentid:t},function(e){if(isedit){if(!confirm("是否删除该商品？"))return;deleteData(e.data.currentid)}})}$("em.goods-delete").on("click",function(){confirm("是否删除该商品？")&&deleteAllData(deleteallArr)})}function updateDataToDataBase(e,a,t){$.ajax({url:"../php/updateToShopCar.php",type:"post",dataType:"json",data:{number:e,totalPrice:a,id:t},success:function(e){}})}function getAllPriceWhenCheckAll(e){for(var a=0;a<e.length;a++)allprice+=parseFloat(e[a][8])}function deleteData(e){$.ajax({url:"../php/deleteSingleShopCar.php",type:"post",dataType:"json",async:!1,data:{id:e},success:function(e){0==e.code&&location.reload()}})}function deleteAllData(e){for(var a="",t=0;t<e.length;t++)a+=e[t]+",";a=a.substring(0,a.length-1),$.ajax({url:"../php/deleteAllShopCar.php",type:"post",dataType:"json",async:!1,data:{idstr:a},success:function(e){0==e.code&&location.reload()}})}$(window).load(function(){var e=unameFromUrl||unameFromCookie;$.ajax({url:"../php/checkShopCar.php",type:"post",dataType:"json",data:{username:e},success:function(e){var a=template("goodsTemplate",{data:e});$("#goodsInfo").html(a),actionsInTable(e)}})});